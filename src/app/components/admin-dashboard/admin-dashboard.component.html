<div class="dashboard-container">
  <!-- Data Mode Indicator -->
  <div class="mode-indicator">
    <span class="mode-badge" [class.demo]="isDemoMode" [class.real]="!isDemoMode">
      <i class="fas" [class.fa-flask]="isDemoMode" [class.fa-database]="!isDemoMode"></i>
      {{ isDemoMode ? 'Demo Mode' : 'Live Data' }}
    </span>
    <button class="toggle-mode-btn" (click)="toggleDataMode()" title="Switch data mode">
      <i class="fas fa-sync-alt"></i>
      Switch to {{ isDemoMode ? 'Live Data' : 'Demo Mode' }}
    </button>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-users"></i>
      </div>
      <div class="stat-info">
        <h3>{{ totalUsers }}</h3>
        <p>Total Users</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-car"></i>
      </div>
      <div class="stat-info">
        <h3>{{ totalCars }}</h3>
        <p>Total Cars</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-box"></i>
      </div>
      <div class="stat-info">
        <h3>{{ totalPackages }}</h3>
        <p>Wash Packages</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="stat-info">
        <h3>{{ activePackages }}</h3>
        <p>Active Packages</p>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <div class="recent-activity">
      <h4>Recent Activity</h4>
      <div class="activity-list">
        <div class="activity-item" *ngFor="let activity of recentActivities">
          <div class="activity-icon">
            <i [class]="activity.icon"></i>
          </div>
          <div class="activity-details">
            <p>{{ activity.message }}</p>
            <small>{{ activity.timestamp | date:'short' }}</small>
          </div>
        </div>
      </div>
    </div>

    <div class="quick-actions">
      <h4>Quick Actions</h4>
      <div class="action-buttons">
        <button class="action-btn primary" (click)="toggleUsersModal()">
          <i class="fas fa-users"></i>
          Manage Users
        </button>
        <button class="action-btn secondary" (click)="toggleCarsModal()">
          <i class="fas fa-car"></i>
          View Cars
        </button>
        <button class="action-btn info" (click)="togglePackagesModal()">
          <i class="fas fa-box"></i>
          View Packages
        </button>
        <button class="action-btn success" (click)="togglePackageModal()">
          <i class="fas fa-plus"></i>
          Add Package
        </button>
      </div>
    </div>
  </div>

  <!-- Users Management Modal -->
  <div class="modal-overlay" *ngIf="showUsersModal" (click)="toggleUsersModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Manage Users</h3>
        <button class="close-btn" (click)="toggleUsersModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="search-bar">
          <input type="text" placeholder="Search users..." [(ngModel)]="userSearchTerm" (keyup)="filterUsers()">
          <i class="fas fa-search"></i>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of filteredUsers">
                <td>{{ user.id }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.phone || 'N/A' }}</td>
                <td>{{ user.address || 'N/A' }}</td>
                <td>
                  <button class="btn-danger" (click)="deleteUser(user.id!)" [disabled]="loadingUserId === user.id">
                    <i class="fas fa-trash" *ngIf="loadingUserId !== user.id"></i>
                    <i class="fas fa-spinner fa-spin" *ngIf="loadingUserId === user.id"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="filteredUsers.length === 0" class="no-data">
            <i class="fas fa-users"></i>
            <p>No users found</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cars Management Modal -->
  <div class="modal-overlay" *ngIf="showCarsModal" (click)="toggleCarsModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>View Cars</h3>
        <button class="close-btn" (click)="toggleCarsModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="search-bar">
          <input type="text" placeholder="Search cars..." [(ngModel)]="carSearchTerm" (keyup)="filterCars()">
          <i class="fas fa-search"></i>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Car Name</th>
                <th>Model</th>
                <th>License Plate</th>
                <th>Owner ID</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let car of filteredCars">
                <td>{{ car.id }}</td>
                <td>{{ car.carName }}</td>
                <td>{{ car.model }}</td>
                <td class="license-plate">{{ car.licensePlate }}</td>
                <td>{{ car.userId }}</td>
                <td>
                  <button class="btn-danger" (click)="deleteCar(car.id!)" [disabled]="loadingCarId === car.id">
                    <i class="fas fa-trash" *ngIf="loadingCarId !== car.id"></i>
                    <i class="fas fa-spinner fa-spin" *ngIf="loadingCarId === car.id"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="filteredCars.length === 0" class="no-data">
            <i class="fas fa-car"></i>
            <p>No cars found</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- View Packages Modal -->
  <div class="modal-overlay" *ngIf="showPackagesModal" (click)="togglePackagesModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>View Wash Packages</h3>
        <button class="close-btn" (click)="togglePackagesModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="search-bar">
          <input type="text" placeholder="Search packages..." [(ngModel)]="packageSearchTerm" (keyup)="filterPackages()">
          <i class="fas fa-search"></i>
        </div>
        <div class="packages-grid">
          <div class="package-card" *ngFor="let package of filteredPackages" 
               [class.inactive]="!package.isActive">
            <div class="package-header">
              <h4>{{ package.name }}</h4>
              <div class="package-status">
                <span class="status-badge" [class.active]="package.isActive" [class.inactive]="!package.isActive">
                  {{ package.isActive ? 'Active' : 'Inactive' }}
                </span>
                <div class="package-actions">
                  <button class="btn-edit" (click)="editPackage(package)" title="Edit Package">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn-danger" (click)="deletePackage(package.id)" 
                          [disabled]="loadingPackageId === package.id" title="Delete Package">
                    <i class="fas fa-trash" *ngIf="loadingPackageId !== package.id"></i>
                    <i class="fas fa-spinner fa-spin" *ngIf="loadingPackageId === package.id"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="package-details">
              <p class="package-description">{{ package.description }}</p>
              <div class="package-info">
                <div class="info-item">
                  <i class="fas fa-dollar-sign"></i>
                  <span class="price">${{ package.price }}</span>
                </div>
                <div class="info-item">
                  <i class="fas fa-clock"></i>
                  <span>{{ package.duration }} min</span>
                </div>
              </div>
              <div class="package-services">
                <h5>Services Included:</h5>
                <div class="services-tags">
                  <span class="service-tag" *ngFor="let service of package.services">
                    {{ service }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="filteredPackages.length === 0" class="no-data">
          <i class="fas fa-box"></i>
          <p>No packages found</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Package Modal -->
  <div class="modal-overlay" *ngIf="showPackageModal" (click)="togglePackageModal()">
    <div class="modal-content package-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Add Wash Package</h3>
        <button class="close-btn" (click)="togglePackageModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form class="package-form" (ngSubmit)="addPackage()" #packageForm="ngForm">
          <div class="form-row">
            <div class="form-group">
              <label for="packageName">Package Name *</label>
              <input type="text" id="packageName" name="name" [(ngModel)]="newPackage.name" required>
            </div>
            <div class="form-group">
              <label for="packagePrice">Price ($) *</label>
              <input type="number" id="packagePrice" name="price" [(ngModel)]="newPackage.price" step="0.01" min="0" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="packageDuration">Duration (minutes) *</label>
              <input type="number" id="packageDuration" name="duration" [(ngModel)]="newPackage.duration" min="1" required>
            </div>
            <div class="form-group">
              <label for="packageStatus">Status</label>
              <select id="packageStatus" name="isActive" [(ngModel)]="newPackage.isActive">
                <option [value]="true">Active</option>
                <option [value]="false">Inactive</option>
              </select>
            </div>
          </div>
          <div class="form-group full-width">
            <label for="packageDescription">Description *</label>
            <textarea id="packageDescription" name="description" [(ngModel)]="newPackage.description" rows="3" required></textarea>
          </div>
          <div class="form-group full-width">
            <label>Services Included</label>
            <div class="services-grid">
              <label class="service-checkbox" *ngFor="let service of availableServices">
                <input type="checkbox" [value]="service" (change)="toggleService(service, $event)">
                <span class="checkmark"></span>
                {{ service }}
              </label>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="resetPackageForm()">Reset</button>
            <button type="submit" class="btn-primary" [disabled]="!packageForm.valid || isAddingPackage">
              <i class="fas fa-plus" *ngIf="!isAddingPackage"></i>
              <i class="fas fa-spinner fa-spin" *ngIf="isAddingPackage"></i>
              {{ isAddingPackage ? 'Adding...' : 'Add Package' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>